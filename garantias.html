<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Garant√≠as</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="page-garantias">
    <!-- Logo oculto para PDF (reutilizamos el mismo archivo) -->
    <img id="pdf-logo" src="img/cvtools.png" style="display:none;" alt="Logo">

    <div class="container">
        <!-- HEADER CORREGIDO: Centrado y consistente -->
        <header class="main-header">
            <div class="logo-container">
                <img src="img/cvtools.png" alt="CV Tools" class="provider-logo">
            </div>
            <h1>Gesti√≥n de Garant√≠as</h1>
        </header>

        <!-- A√ëADIDO: 'content-box' para que tenga fondo blanco y sombra -->
        <main class="content-box">
            <p style="margin-bottom:20px; color:#555;">
                Rellena los datos de la incidencia. Generaremos un PDF con las im√°genes adjuntas listo para enviar.
            </p>
            
            <form id="warrantyForm" class="warranty-form">
                <div class="form-group">
                    <label for="ref">Referencia del Producto:</label>
                    <input type="text" id="ref" class="form-input" required placeholder="Ej: 12345-X">
                </div>

                <div class="form-group">
                    <label for="invoice">N¬∫ Albar√°n / Factura:</label>
                    <input type="text" id="invoice" class="form-input" required placeholder="Ej: FA-2024-001">
                </div>

                <div class="form-group">
                    <label for="reason">Descripci√≥n de la incidencia:</label>
                    <textarea id="reason" rows="5" class="form-textarea" required placeholder="Describe brevemente qu√© le ocurre al producto..."></textarea>
                </div>

                <div class="upload-area">
                    <h4 style="margin-top:0;">üì∏ Evidencias Fotogr√°ficas</h4>
                    <div style="margin-bottom:10px; text-align:left;">
                        <label style="font-size:0.9em; display:block; margin-bottom:5px;">Foto 1 (Producto completo):</label>
                        <input type="file" id="img1" accept="image/*" style="width:100%">
                    </div>
                    <div style="text-align:left;">
                        <label style="font-size:0.9em; display:block; margin-bottom:5px;">Foto 2 (Detalle del fallo):</label>
                        <input type="file" id="img2" accept="image/*" style="width:100%">
                    </div>
                </div>

                <button type="submit" class="download-button pdf" id="btn-generate" style="margin-top:10px;">
                    üì• Generar y Descargar PDF
                </button>
            </form>

            <div style="text-align:center;">
                <a href="index.html" class="back-link">‚Üê Volver al men√∫ principal</a>
            </div>
        </main>
    </div>

    <!-- Script PDF (Sin cambios funcionales, solo estructura) -->
    <script>
        document.getElementById('warrantyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-generate');
            const originalText = btn.textContent;
            btn.textContent = "‚è≥ Procesando...";
            btn.disabled = true;

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Usamos el mismo logo de cvtools para el PDF
                const logoElem = document.getElementById('pdf-logo');
                try { doc.addImage(logoElem, 'PNG', 15, 10, 40, 15); } catch(err){}

                doc.setFontSize(16);
                doc.text("HOJA DE RECLAMACI√ìN", 195, 20, { align: 'right' });
                doc.setFontSize(10);
                doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 195, 26, { align: 'right' });

                const ref = document.getElementById('ref').value;
                const invoice = document.getElementById('invoice').value;
                const reason = document.getElementById('reason').value;

                doc.setFont("helvetica", "bold");
                doc.text("DATOS DE LA INCIDENCIA:", 15, 50);
                doc.setFont("helvetica", "normal");
                doc.text(`Producto: ${ref}`, 15, 60);
                doc.text(`Factura/Albar√°n: ${invoice}`, 15, 67);
                doc.text("Motivo:", 15, 80);
                const splitReason = doc.splitTextToSize(reason, 180); 
                doc.text(splitReason, 15, 87);

                let currentY = 87 + (splitReason.length * 5) + 10;
                
                // Im√°genes
                const readImage = (input) => {
                    if (input.files && input.files[0]) {
                        return new Promise((r) => {
                            const reader = new FileReader();
                            reader.onload = (e) => r(e.target.result);
                            reader.readAsDataURL(input.files[0]);
                        });
                    }
                    return Promise.resolve(null);
                };

                const img1Data = await readImage(document.getElementById('img1'));
                const img2Data = await readImage(document.getElementById('img2'));

                if (img1Data || img2Data) {
                    doc.text("FOTOS:", 15, currentY);
                    currentY += 10;
                    if (img1Data) {
                        doc.addImage(img1Data, 'JPEG', 15, currentY, 80, 60);
                        if (img2Data) doc.addImage(img2Data, 'JPEG', 110, currentY, 80, 60);
                    } else if (img2Data) {
                        doc.addImage(img2Data, 'JPEG', 15, currentY, 80, 60);
                    }
                }

                doc.save(`Reclamacion_${ref}.pdf`);
            } catch (error) {
                alert("Error al generar PDF. Intenta con im√°genes m√°s peque√±as.");
                console.error(error);
            }
            btn.textContent = originalText;
            btn.disabled = false;
        });
    </script>
</body>
</html>